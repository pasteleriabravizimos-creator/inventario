<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<title>ERP Inventario ‚Äì BRAVIZIMO'S</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<!-- LIBS -->
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
  --bg:#0b1220;
  --card:#111b2e;
  --line:#223255;
  --txt:#e8f0ff;
  --muted:#9fb0d0;
  --accent:#5eead4;
  --ok:#22c55e;
  --warn:#fbbf24;
  --crit:#ef4444;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
  background:linear-gradient(180deg,#070b14,#0b1220);
  color:var(--txt);
}
header{
  display:flex;align-items:center;gap:14px;
  padding:14px 18px;
  background:rgba(11,18,32,.9);
  border-bottom:1px solid var(--line);
}
header img{height:42px}
header h1{font-size:18px;margin:0}
.wrap{max-width:1400px;margin:auto;padding:16px}
.grid{display:grid;grid-template-columns:240px 1fr;gap:14px}
aside{
  background:var(--card);
  border:1px solid var(--line);
  border-radius:14px;
  padding:12px;
}
aside button{
  width:100%;
  margin:6px 0;
  padding:10px;
  border-radius:10px;
  border:1px solid var(--line);
  background:#0f1a2f;
  color:var(--txt);
  cursor:pointer;
}
aside button.active{outline:2px solid var(--accent)}
main{
  background:var(--card);
  border:1px solid var(--line);
  border-radius:14px;
  padding:16px;
}
.card{
  background:#0f1a2f;
  border:1px solid var(--line);
  border-radius:12px;
  padding:12px;
  margin-bottom:12px;
}
.row{display:flex;gap:12px;flex-wrap:wrap}
.stat{
  flex:1;
  padding:14px;
  background:#0c162a;
  border-radius:12px;
  border:1px solid var(--line);
}
.stat h3{margin:0;font-size:13px;color:var(--muted)}
.stat b{font-size:22px}
table{
  width:100%;
  border-collapse:collapse;
  font-size:13px;
}
th,td{
  padding:8px;
  border-bottom:1px solid var(--line);
}
th{color:var(--muted);text-align:left}
input,select{
  background:#0b1529;
  color:var(--txt);
  border:1px solid var(--line);
  border-radius:8px;
  padding:8px;
}
button.action{
  background:var(--accent);
  color:#022c22;
  border:none;
  border-radius:10px;
  padding:10px 14px;
  cursor:pointer;
}
.hidden{display:none}
.ok{color:var(--ok)}
.warn{color:var(--warn)}
.crit{color:var(--crit)}
</style>
</head>

<body>
<header>
  <img src="https://raw.githubusercontent.com/pasteleriabravizimos-creator/inventario/main/logo.png" />
  <h1>ERP Web Inventario ‚Äì BRAVIZIMO'S</h1>
</header>

<div class="wrap">
<div class="grid">

<!-- MENU -->
<aside>
  <button class="active" onclick="show('dashboard')">üìä Dashboard</button>
  <button onclick="show('insumos')">üì¶ Insumos</button>
  <button onclick="show('productos')">üí≤ Productos</button>
  <button onclick="show('recetas')">üìñ Recetas & Packs</button>
  <button onclick="show('produccion')">üë©‚Äçüç≥ Producci√≥n / Ventas</button>
  <button onclick="show('kardex')">üìí Kardex</button>
  <button onclick="show('reportes')">üìà Reportes</button>
  <hr>
  <button onclick="importBase()">‚¨Ü Importar Base Excel</button>
  <button onclick="importProduccion()">‚¨Ü Importar Producci√≥n</button>
</aside>

<!-- MAIN -->
<main>

<!-- DASHBOARD -->
<section id="dashboard">
  <div class="row">
    <div class="stat">
      <h3>Inventario valorizado</h3>
      <b id="invValor">S/ 0.00</b>
    </div>
    <div class="stat">
      <h3>Insumos</h3>
      <b id="invCount">0</b>
    </div>
    <div class="stat">
      <h3>Producci√≥n acumulada</h3>
      <b id="prodCount">0</b>
    </div>
  </div>
  <canvas id="chartValor" height="120"></canvas>
</section>

<!-- INSUMOS -->
<section id="insumos" class="hidden">
  <div class="card">
    <h3>Inventario de Insumos</h3>
    <table id="tblInsumos">
      <thead>
        <tr><th>Categor√≠a</th><th>Insumo</th><th>Unidad</th><th>Stock</th><th>Costo</th><th>Estado</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</section>

<!-- PRODUCTOS -->
<section id="productos" class="hidden">
  <div class="card">
    <h3>Productos de Venta</h3>
    <table id="tblProductos">
      <thead><tr><th>Producto</th><th>Precio</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>
</section>

<!-- RECETAS -->
<section id="recetas" class="hidden">
  <div class="card">
    <h3>Recetas y Packs</h3>
    <div id="recetasList"></div>
  </div>
</section>

<!-- PRODUCCION -->
<section id="produccion" class="hidden">
  <div class="card">
    <h3>Producci√≥n / Ventas</h3>
    <table id="tblProd">
      <thead>
        <tr><th>Fecha</th><th>Producto</th><th>Cantidad</th><th>Costo</th><th>Venta</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</section>

<!-- KARDEX -->
<section id="kardex" class="hidden">
  <div class="card">
    <h3>Kardex (Ingresos / Salidas)</h3>
    <table id="tblKardex">
      <thead>
        <tr><th>Fecha</th><th>Tipo</th><th>Insumo</th><th>Cantidad</th><th>Nota</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</section>

<!-- REPORTES -->
<section id="reportes" class="hidden">
  <div class="card">
    <h3>Reporte por fecha</h3>
    <input type="date" id="repDesde">
    <input type="date" id="repHasta">
    <button class="action" onclick="genReporte()">Ver reporte</button>
    <div id="repResultado"></div>
  </div>
</section>

</main>
</div>
</div>

<script>
/* =======================
   BASE DE DATOS LOCAL
======================= */
let DB={
 insumos:[],
 productos:[],
 recetas:[],
 packs:[],
 produccion:[],
 kardex:[]
};

/* =======================
   UI
======================= */
function show(id){
 document.querySelectorAll('main section').forEach(s=>s.classList.add('hidden'));
 document.getElementById(id).classList.remove('hidden');
 document.querySelectorAll('aside button').forEach(b=>b.classList.remove('active'));
}

/* =======================
   IMPORTACIONES
======================= */
function importBase(){
 alert("Selecciona el Excel BASE (insumos, precio, receta, pack)");
 filePick(handleBase);
}
function importProduccion(){
 alert("Selecciona SOLO la hoja PRODUCCION");
 filePick(handleProduccion);
}
function filePick(cb){
 let i=document.createElement('input');
 i.type='file';
 i.accept='.xlsx';
 i.onchange=e=>cb(e.target.files[0]);
 i.click();
}

/* =======================
   PROCESO EXCEL
======================= */
function handleBase(file){
 const r=new FileReader();
 r.onload=e=>{
  const wb=XLSX.read(e.target.result,{type:'binary'});
  DB.insumos=XLSX.utils.sheet_to_json(wb.Sheets.insumos||[]);
  DB.productos=XLSX.utils.sheet_to_json(wb.Sheets.precio||[]);
  DB.recetas=XLSX.utils.sheet_to_json(wb.Sheets.receta||[]);
  DB.packs=XLSX.utils.sheet_to_json(wb.Sheets.pack||[]);
  renderAll();
 };
 r.readAsBinaryString(file);
}

function handleProduccion(file){
 const r=new FileReader();
 r.onload=e=>{
  const wb=XLSX.read(e.target.result,{type:'binary'});
  let prod=XLSX.utils.sheet_to_json(wb.Sheets.produccion||[]);
  DB.produccion.push(...prod);
  renderAll();
 };
 r.readAsBinaryString(file);
}

/* =======================
   RENDER
======================= */
function renderAll(){
 renderInsumos();
 renderProductos();
 renderRecetas();
 renderProduccion();
 renderDashboard();
}

function renderInsumos(){
 let tb=document.querySelector('#tblInsumos tbody');
 tb.innerHTML='';
 DB.insumos.forEach(i=>{
  let estado=i.Stock_Inicial<=0?'crit':'ok';
  tb.innerHTML+=`<tr>
   <td>${i.Categoria||'INSUMOS'}</td>
   <td>${i.Ingrediente}</td>
   <td>${i.Unidad}</td>
   <td>${i.Stock_Inicial}</td>
   <td>S/ ${i.Costo_Unitario||0}</td>
   <td class="${estado}">${estado==='ok'?'Normal':'Cr√≠tico'}</td>
  </tr>`;
 });
}

function renderProductos(){
 let tb=document.querySelector('#tblProductos tbody');
 tb.innerHTML='';
 DB.productos.forEach(p=>{
  tb.innerHTML+=`<tr><td>${p.Producto}</td><td>S/ ${p.Precio}</td></tr>`;
 });
}

function renderRecetas(){
 let d=document.getElementById('recetasList');
 d.innerHTML='';
 DB.recetas.forEach(r=>{
  d.innerHTML+=`<div>${r.Producto} ‚Üí ${r.Ingrediente} (${r.Cantidad})</div>`;
 });
}

function renderProduccion(){
 let tb=document.querySelector('#tblProd tbody');
 tb.innerHTML='';
 DB.produccion.forEach(p=>{
  tb.innerHTML+=`<tr>
   <td>${p.F_Emisi√≥n}</td>
   <td>${p.Item}</td>
   <td>${p.Cantidad}</td>
   <td>S/ 0.00</td>
   <td>S/ ${p.Monto||0}</td>
  </tr>`;
 });
}

function renderDashboard(){
 document.getElementById('invCount').innerText=DB.insumos.length;
 document.getElementById('prodCount').innerText=DB.produccion.length;
 let total=0;
 DB.insumos.forEach(i=>total+= (i.Stock_Inicial||0)*(i.Costo_Unitario||0));
 document.getElementById('invValor').innerText='S/ '+total.toFixed(2);
}

/* =======================
   REPORTES
======================= */
function genReporte(){
 document.getElementById('repResultado').innerHTML=
  `<p>Producci√≥n: ${DB.produccion.length}</p>`;
}
</script>

</body>
</html>
