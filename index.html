<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>ERP Inventario ‚Äì BRAVIZIMO‚ÄôS</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
 --bg:#0b1220;--card:#111b2e;--line:#223255;
 --txt:#e8f0ff;--muted:#9fb0d0;--accent:#5eead4;
 --ok:#22c55e;--warn:#fbbf24;--crit:#ef4444
}
*{box-sizing:border-box}
body{margin:0;font-family:system-ui;background:linear-gradient(180deg,#070b14,#0b1220);color:var(--txt)}
header{display:flex;gap:14px;align-items:center;padding:14px;border-bottom:1px solid var(--line)}
header img{height:42px}
header h1{font-size:18px;margin:0}
.wrap{max-width:1500px;margin:auto;padding:16px}
.grid{display:grid;grid-template-columns:260px 1fr;gap:14px}
aside{background:var(--card);border-radius:14px;padding:12px;border:1px solid var(--line)}
aside button{width:100%;padding:10px;margin:6px 0;border-radius:10px;background:#0f1a2f;color:var(--txt);border:1px solid var(--line);cursor:pointer}
aside button.active{outline:2px solid var(--accent)}
main{background:var(--card);border-radius:14px;padding:16px;border:1px solid var(--line)}
.card{background:#0f1a2f;border-radius:12px;padding:14px;border:1px solid var(--line);margin-bottom:12px}
.row{display:flex;gap:12px;flex-wrap:wrap}
.stat{flex:1;background:#0c162a;padding:14px;border-radius:12px;border:1px solid var(--line)}
.stat h3{margin:0;color:var(--muted);font-size:13px}
.stat b{font-size:22px}
table{width:100%;border-collapse:collapse;font-size:13px}
th,td{padding:8px;border-bottom:1px solid var(--line)}
th{color:var(--muted);text-align:left}
.hidden{display:none}
.ok{color:var(--ok)}.warn{color:var(--warn)}.crit{color:var(--crit)}
input,select{background:#0b1529;color:var(--txt);border:1px solid var(--line);border-radius:8px;padding:8px}
button.action{background:var(--accent);color:#022c22;border:none;border-radius:10px;padding:10px 14px;cursor:pointer}
</style>
</head>

<body>
<header>
 <img src="https://raw.githubusercontent.com/pasteleriabravizimos-creator/inventario/main/logo.png">
 <h1>ERP Web Inventario ‚Äì BRAVIZIMO‚ÄôS</h1>
</header>

<div class="wrap">
<div class="grid">

<aside>
 <button class="active" onclick="show('dashboard')">üìä Dashboard</button>
 <button onclick="show('insumos')">üì¶ Insumos</button>
 <button onclick="show('productos')">üí≤ Productos</button>
 <button onclick="show('recetas')">üìñ Recetas & Packs</button>
 <button onclick="show('produccion')">üë©‚Äçüç≥ Producci√≥n / Ventas</button>
 <button onclick="show('kardex')">üìí Kardex</button>
 <button onclick="show('reportes')">üìà Reportes</button>
 <hr>
 <button onclick="importBase()">‚¨Ü Importar Base Excel</button>
 <button onclick="importProduccion()">‚¨Ü Importar Producci√≥n</button>
</aside>

<main>

<section id="dashboard">
 <div class="row">
  <div class="stat"><h3>Inventario valorizado</h3><b id="invValor">S/ 0.00</b></div>
  <div class="stat"><h3>Total Insumos</h3><b id="invCount">0</b></div>
  <div class="stat"><h3>Producci√≥n acumulada</h3><b id="prodCount">0</b></div>
  <div class="stat"><h3>Margen estimado</h3><b id="margen">S/ 0.00</b></div>
 </div>
 <canvas id="chartInv" height="120"></canvas>
</section>

<section id="insumos" class="hidden">
 <div class="card">
  <h3>Inventario de Insumos</h3>
  <table id="tblInsumos"><thead>
   <tr><th>Categor√≠a</th><th>Insumo</th><th>Unidad</th><th>Stock</th><th>Costo</th><th>Estado</th></tr>
  </thead><tbody></tbody></table>
 </div>
</section>

<section id="productos" class="hidden">
 <div class="card">
  <h3>Productos de Venta</h3>
  <table id="tblProductos"><thead>
   <tr><th>Producto</th><th>Precio</th></tr>
  </thead><tbody></tbody></table>
 </div>
</section>

<section id="recetas" class="hidden">
 <div class="card">
  <h3>Recetas y Packs</h3>
  <div id="lstRecetas"></div>
 </div>
</section>

<section id="produccion" class="hidden">
 <div class="card">
  <h3>Producci√≥n / Ventas</h3>
  <table id="tblProd"><thead>
   <tr><th>Fecha</th><th>Producto</th><th>Cantidad</th><th>Costo</th><th>Venta</th></tr>
  </thead><tbody></tbody></table>
 </div>
</section>

<section id="kardex" class="hidden">
 <div class="card">
  <h3>Kardex</h3>
  <table id="tblKardex"><thead>
   <tr><th>Fecha</th><th>Tipo</th><th>Insumo</th><th>Cantidad</th><th>Nota</th></tr>
  </thead><tbody></tbody></table>
 </div>
</section>

<section id="reportes" class="hidden">
 <div class="card">
  <h3>Reporte por Fecha</h3>
  <input type="date" id="fDesde">
  <input type="date" id="fHasta">
  <button class="action" onclick="genReporte()">Ver</button>
  <div id="repOut"></div>
 </div>
</section>

</main>
</div>
</div>

<script>
let DB={insumos:[],productos:[],recetas:[],packs:[],produccion:[],kardex:[]};

function show(id){
 document.querySelectorAll('main section').forEach(s=>s.classList.add('hidden'));
 document.getElementById(id).classList.remove('hidden');
 document.querySelectorAll('aside button').forEach(b=>b.classList.remove('active'));
}

function filePick(cb){
 let i=document.createElement('input');
 i.type='file';i.accept='.xlsx';
 i.onchange=e=>cb(e.target.files[0]);i.click();
}

function importBase(){filePick(handleBase)}
function importProduccion(){filePick(handleProduccion)}

function handleBase(file){
 const r=new FileReader();
 r.onload=e=>{
  const wb=XLSX.read(e.target.result,{type:'binary'});
  DB.insumos=XLSX.utils.sheet_to_json(wb.Sheets.insumos||[]);
  DB.productos=XLSX.utils.sheet_to_json(wb.Sheets.precio||[]);
  DB.recetas=XLSX.utils.sheet_to_json(wb.Sheets.receta||[]);
  DB.packs=XLSX.utils.sheet_to_json(wb.Sheets.pack||[]);
  renderAll();
 };
 r.readAsBinaryString(file);
}

function handleProduccion(file){
 const r=new FileReader();
 r.onload=e=>{
  const wb=XLSX.read(e.target.result,{type:'binary'});
  const prod=XLSX.utils.sheet_to_json(wb.Sheets.produccion||[]);
  DB.produccion.push(...prod);
  descontarStock(prod);
  renderAll();
 };
 r.readAsBinaryString(file);
}

function descontarStock(prod){
 prod.forEach(p=>{
  DB.recetas.filter(r=>r.Producto===p.Item)
   .forEach(r=>{
    let ins=DB.insumos.find(i=>i.Ingrediente===r.Ingrediente);
    if(ins){ins.Stock_Inicial-= (r.Cantidad*p.Cantidad);}
   });
 });
}

function renderAll(){
 renderInsumos();renderProductos();renderRecetas();
 renderProduccion();renderDashboard();
}

function renderInsumos(){
 let tb=document.querySelector('#tblInsumos tbody');tb.innerHTML='';
 DB.insumos.forEach(i=>{
  let st=i.Stock_Inicial<=0?'crit':'ok';
  tb.innerHTML+=`<tr>
   <td>${i.Categoria||'INSUMOS'}</td>
   <td>${i.Ingrediente}</td>
   <td>${i.Unidad}</td>
   <td>${i.Stock_Inicial}</td>
   <td>S/ ${i.Costo_Unitario||0}</td>
   <td class="${st}">${st==='ok'?'Normal':'Cr√≠tico'}</td>
  </tr>`;
 });
}

function renderProductos(){
 let tb=document.querySelector('#tblProductos tbody');tb.innerHTML='';
 DB.productos.forEach(p=>tb.innerHTML+=`<tr><td>${p.Producto}</td><td>S/ ${p.Precio}</td></tr>`);
}

function renderRecetas(){
 let d=document.getElementById('lstRecetas');d.innerHTML='';
 DB.recetas.forEach(r=>d.innerHTML+=`<div>${r.Producto} ‚Üí ${r.Ingrediente} (${r.Cantidad})</div>`);
}

function renderProduccion(){
 let tb=document.querySelector('#tblProd tbody');tb.innerHTML='';
 DB.produccion.forEach(p=>{
  tb.innerHTML+=`<tr><td>${p.F_Emisi√≥n}</td><td>${p.Item}</td><td>${p.Cantidad}</td><td>-</td><td>S/ ${p.Monto}</td></tr>`;
 });
}

function renderDashboard(){
 let total=0;DB.insumos.forEach(i=>total+=(i.Stock_Inicial||0)*(i.Costo_Unitario||0));
 document.getElementById('invValor').innerText='S/ '+total.toFixed(2);
 document.getElementById('invCount').innerText=DB.insumos.length;
 document.getElementById('prodCount').innerText=DB.produccion.length;
}

function genReporte(){
 document.getElementById('repOut').innerHTML=
 `<p>Pedidos: ${DB.produccion.length}</p>`;
}
</script>
</body>
</html>
