<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>ERP Inventario - BRAVIZIMO'S</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body{margin:0;font-family:Segoe UI;background:#0b1220;color:#e8f0ff}
header{display:flex;align-items:center;gap:12px;padding:14px 20px;background:#0e1628;border-bottom:1px solid #1f2a44}
header img{height:36px}
header h1{font-size:18px;margin:0}
.wrap{display:flex;height:calc(100vh - 64px)}
nav{width:260px;background:#0e1628;border-right:1px solid #1f2a44;padding:12px}
nav button{width:100%;margin:6px 0;padding:10px;border-radius:8px;border:1px solid #1f2a44;background:#131c33;color:#e8f0ff;cursor:pointer}
nav button.active{border-color:#5eead4}
main{flex:1;padding:16px;overflow:auto}
.card{background:#131c33;border:1px solid #1f2a44;border-radius:12px;padding:14px;margin-bottom:14px}
.hidden{display:none}
table{width:100%;border-collapse:collapse}
th,td{padding:8px;border-bottom:1px solid #1f2a44;font-size:13px}
th{text-align:left;color:#94a3b8}
input,select{background:#0b1220;color:#e8f0ff;border:1px solid #1f2a44;border-radius:6px;padding:6px}
</style>
</head>

<body>

<header>
  <img src="logo.png" alt="Bravizimo's">
  <h1>ERP Inventario ‚Äì BRAVIZIMO'S</h1>
</header>

<div class="wrap">
<nav id="menu"></nav>
<main id="content"></main>
</div>

<script>
// ================== BASE DE DATOS ==================
const DB = {
 insumos: JSON.parse(localStorage.getItem("insumos")||"[]"),
 productos: JSON.parse(localStorage.getItem("productos")||"[]"),
 recetas: JSON.parse(localStorage.getItem("recetas")||"[]"),
 produccion: JSON.parse(localStorage.getItem("produccion")||"[]"),
 kardex: JSON.parse(localStorage.getItem("kardex")||"[]"),
 rol: localStorage.getItem("rol") || "ADMIN"
};

function save(){ Object.keys(DB).forEach(k=>{
 if(k!=="rol") localStorage.setItem(k,JSON.stringify(DB[k]));
});}

// ================== MENU ==================
const menu = document.getElementById("menu");
function renderMenu(){
 menu.innerHTML = `
  <button onclick="dashboard()">üìä Dashboard</button>
  <button onclick="insumos()">üì¶ Insumos</button>
  ${DB.rol==="ADMIN"?`
  <button onclick="productos()">üí≤ Productos</button>
  <button onclick="recetas()">üìñ Recetas & Packs</button>
  <button onclick="produccion()">üë©‚Äçüç≥ Producci√≥n / Pedidos</button>
  <button onclick="reportes()">üìÜ Reportes</button>`:""}
  <button onclick="kardex()">üìí Kardex</button>
 `;
}
renderMenu();

// ================== DASHBOARD ==================
function dashboard(){
 const total = DB.insumos.reduce((s,i)=>s+(i.stock*i.costo),0);
 document.getElementById("content").innerHTML = `
 <div class="card">
  <h3>Inventario valorizado</h3>
  <h2>S/ ${total.toFixed(2)}</h2>
 </div>
 <canvas id="chart"></canvas>
 `;
 const ctx = document.getElementById("chart");
 new Chart(ctx,{
  type:"bar",
  data:{
   labels:DB.insumos.map(i=>i.nombre),
   datasets:[{label:"Valor",data:DB.insumos.map(i=>i.stock*i.costo),backgroundColor:"#5eead4"}]
  }
 });
}

// ================== INSUMOS ==================
function insumos(){
 let rows = DB.insumos.map(i=>`
 <tr><td>${i.categoria}</td><td>${i.nombre}</td><td>${i.stock}</td><td>S/ ${i.costo}</td></tr>
 `).join("");
 document.getElementById("content").innerHTML = `
 <div class="card"><h3>Insumos</h3>
 <table><tr><th>Cat</th><th>Insumo</th><th>Stock</th><th>Costo</th></tr>${rows}</table>
 </div>`;
}

// ================== PRODUCCI√ìN ==================
function produccion(){
 document.getElementById("content").innerHTML = `
 <div class="card">
  <h3>Registrar producci√≥n</h3>
  <input id="prodNombre" placeholder="Producto">
  <input id="prodCant" type="number" placeholder="Cantidad">
  <button onclick="guardarProduccion()">Registrar</button>
 </div>`;
}

function guardarProduccion(){
 const nombre=document.getElementById("prodNombre").value;
 const cant=+document.getElementById("prodCant").value;
 const receta = DB.recetas.filter(r=>r.producto===nombre);
 receta.forEach(r=>{
  const ins=DB.insumos.find(i=>i.nombre===r.insumo);
  ins.stock -= r.cantidad*cant;
 });
 DB.produccion.push({fecha:new Date().toISOString().slice(0,10),producto:nombre,cantidad:cant});
 save(); alert("Producci√≥n registrada");
}

// ================== KARDEX ==================
function kardex(){
 let rows = DB.kardex.map(k=>`
 <tr><td>${k.fecha}</td><td>${k.tipo}</td><td>${k.insumo}</td><td>${k.cantidad}</td></tr>
 `).join("");
 document.getElementById("content").innerHTML = `
 <div class="card"><h3>Kardex</h3>
 <table><tr><th>Fecha</th><th>Tipo</th><th>Insumo</th><th>Cant</th></tr>${rows}</table>
 </div>`;
}

// ================== INIT ==================
dashboard();
</script>

</body>
</html>
